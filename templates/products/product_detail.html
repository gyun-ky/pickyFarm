{% extends "base/base_for_other.html" %}
{% block og_url %}{% url 'products:product_detail' product.pk %}{% endblock %}
{% block og_title %}{{product.title}}{% endblock %}
{% block og_desc %}{{product.sub_title}}{% endblock %}
{% block og_image %}{{product.main_image.url}}{% endblock %}
{% block title_name %}{{product.title}}{% endblock %}
{% load humanize %}

{% load static %}
{% block stylesheet %}
<link rel="stylesheet" href="{% static 'css/products/product_detail.css' %}">
<link rel="stylesheet" href="{% static 'css/products/product_detail_mobile.css' %}">
<link rel="stylesheet" href="{% static 'css/products/product_review.css' %}">
<link rel="stylesheet" href="{% static 'css/products/product_review_mobile.css' %}">
<link rel="stylesheet" href="{% static 'css/products/product_question_mobile.css' %}">
<link rel="stylesheet" href="{% static 'css/products/product_refund_change.css' %}">
<link rel="stylesheet" href="{% static 'css/products/product_refund_change_mobile.css' %}">


<!-- <script defer src='https://kit.fontawesome.com/a076d05399.js'></script> -->


{% endblock stylesheet %}
{% block main_content %}

<div class="main-contents lg:mx-20 sm:mx-8 bg-white-400 text-center font-4xl">
    <div id="product_content" name="{{product.pk}}" class="flex flex-row mx-auto z-0">
        <div id="left" class="w=2/5">
            <div>
                <img id="main_image" src="{{product.main_image.url}}">
            </div>
            <div class="w-full flex flex-rows mt-3">
                {% if product.product_images is not None %}
                {% for image in product.product_images.all %}

                <img id="images" class="mr-3" src="{{image.image.url}}">

                {% endfor %}
                {% endif %}
            </div>
            <div class="ml-7 mt-10 text-left" id="farm_news_letter">
                농가 소식
            </div>
            <div id="farm_news" class="relative mt-1 py-2">
                <img class="absolute -top-6 -left-2" src="{% static 'images/product_detail/bell.svg' %}">
                {% if farmer.farm_news %}
                {{farmer.farm_news}}
                {% else %}
                <div class="font-light text-center">등록된 뉴스가 아직 없습니다.</div>
                {% endif %}
            </div>
        </div>
        <div id="right" class="w-3/5 pr-10 pl-12">
            <div id="top_section" class="flex flex-row">
                <div id="title_section" class="w-5/6">
                    <div id="tags" class="flex flex-row">

                        {% if kinds == "ugly" %}
                        <div id="ugly_tag">무난이 작물</div>
                        {% elif kinds == "normal" %}
                        <div id="normal_tag">일반 작물</div>
                        {% elif kinds == "mix" %}
                        <div id="mix_tag">일반&nbsp&nbsp&nbsp<span class="ugly-in-mix">무난이</span></div>
                        {% endif %}
                    </div>
                    <div id="title">
                        {{product.title}}
                    </div>
                    <div id="subtitle">
                        {{product.sub_title}}
                    </div>
                </div>
                <div id="share" class="w-1/6">
                    <div>
                        <img src="{% static 'images/product_detail/share.svg' %}">
                    </div>
                    <div id="url_copy">
                        URL 복사
                    </div>
                </div>
            </div>
            <div id="cost" class="pt-8 pb-6 mb-2">
                {{product.sell_price | intcomma}}원
            </div>

            <div id="farmer_section" class="flex flex-row items-center mt-3">
                <div id="farmer_image">
                    <img src="{{farmer.farmer_profile.url}}" id="farmer_img" alt="농장주사진">
                </div>
                <div id="farm_name" class="ml-4 pt-1">
                    {{farmer.farm_name}}
                </div>
                <div id="farmer_name" class="ml-2">
                    {{farmer.user.nickname}}
                </div>
                <a href="{% url 'farmers:farmer_detail' farmer.pk %}">
                    <div id="visit" class="ml-4 transition_element">
                        방문하기
                    </div>
                </a>
                <div id="sub" name="{{farmer.pk}}" class="ml-2 transition_element">
                    구독하기
                </div>
            </div>
            <div id="info_section" class="border-b mt-12 pt-5 pb-5">
                <div class="flex flex-rows">
                    <div id="info_t" class="w-1/5 text-left">배송비</div>
                    <div id="shipping-fee" class="w-4/5 text-left text-red-500">{{product.default_delivery_fee | intcomma}}원</div>
                </div>
                <div id="shipping-fee-desc" class="mb-3">
                    {{product.additional_delivery_fee_unit}}개 마다 추가 배송비 부과 / 제주 외 도서지역 추가 배송비 추가
                </div>
                <div class="flex flex-rows mb-3">
                    <div id="info_t" class="w-1/5 text-left">배송 기간</div>
                    <div id="shipping-fee" class="w-4/5 text-left text-red-500">{{farmer.shipping_description}}</div>
                </div>
                <div class="flex flex-rows mb-3">
                    <div id="info_t" class="w-1/5 text-left">중량/용량</div>
                    <div id="product-weight" class="w-4/5 text-left">{{product.weight}}{{product.weight_unit}}</div>
                </div>
                <div class="flex flex-rows mb-3">
                    <div id="info_t" class="w-1/5 text-left">원산지</div>
                    <div id="info_c" class="w-4/5 text-left">국산</div>
                </div>
                {% comment %} <div class="flex flex-rows mb-3">
                    <div id="info_t" class="w-1/5 text-left">안내사항</div>
                    <div id="info_c" class="w-4/5 text-left">{{product.instruction}}</div>
                </div> {% endcomment %}
            </div>
            <div id="product-option-section" class="border-b flex py-3">
                <select name="product-option" id="product-option" class="w-full" onchange="if(this.value) location.href=this.value;">
                    {% for sibling in siblings %}
                    <option value="{% url 'products:product_detail' sibling.pk %}" {% if sibling.pk == product_pk %}selected{% endif %}>{{sibling.option_name}}</option>
                    {% endfor %}
                </select>
            </div>
            <div id="purchase_number_section" class="flex flex-row items-center py-10 mb-5 border-b">
                <div id="quantity_letter" class="mr-12">구매수량</div>
                <div id="quantity_num_section" class="flex flex-row items-center">
                    <div id="minus_btn">-</div>
                    {% if product.open == True %}
                    <div id="quantity_number" class="">1</div>
                    {% else %}
                    <div id="quantity_number" class="">0</div>
                    {% endif %}
                    <div id="plus_btn">+</div>
                </div>
            </div>
            <div class="flex flex-rows justify-end items-end mt-10 mb-7 pt-10" id="total_price_section">
                <div id="total_price_letter" class="mb-4 mr-10">총 상품 금액 :</div>
                <div id="total_price">{{product.sell_price}}</div>
                <div id="won" class="mb-2 ml-2">원</div>
            </div>
            <div id="buttons" class="flex flex-row justify-end">
                <div id="wish" class="transition_element flex justify-center items-center">
                    <img src="{% static 'images/like.svg' %}" alt="찜하기" class="svg-buttons">
                </div>
                {% if product.open == True %}
                <div id="cart" name="{{product_pk}}" class="mr-auto ml-3 transition_element flex justify-center items-center">
                    <img src="{% static 'images/cart.svg' %}" alt="장바구니 담기" class="svg-buttons">
                </div>
                <div id="gift" name="{{product.pk}}">선물하기</div>
                <div id="purchase" name="{{product_pk}}">바로 구매하기</div>
                {% else %}
                <div id="soldout" name="{{product.pk}}">곧 다시 만나요!</div>
                {% endif %}
            </div>
        </div>
    </div>


</div>
</div>

<!-- 상품설명 -->
{% include 'products/detail/product_desc.html' %}

<!-- 상세정보 -->
{% include 'products/detail/product_info.html' %}

<!-- 리뷰 -->
{% include 'products/detail/product_review.html' %}

<!-- 상품문의 -->
{% include 'products/detail/product_qna.html' %}

<!-- 교환/환불 -->
{% include 'products/detail/product_refund_change.html' %}

<!-- 농가 구독 플로팅 버튼 -->
<div class="flex flex-row" id="farmer-sub-wrap">
    <img src="{{ farmer.farmer_profile.url }}" alt="농가 프로필 이미지" id="farmer-sub-profile">
    <img src="{% static 'images/base/sub_floating_btn.svg' %}" name={{farmer.pk}} alt="농가 구독하기" id="farmer-sub-icon">
</div>


<script>

    function removeCommaInStringifiedNumber(num) {
        return parseInt(num.replace(/,/g, "")) // remove comma using regex
     }

    // 구독하기
    const subBtn = document.getElementById('sub')
    const subURL = "{% url 'users:subs' %}"

    // 선물하기
    const giftButton = document.getElementById('gift')
    const giftURL = "{% url 'orders:payment_gift' %}"

    // 품절 상품
    const soldoutButton = document.getElementById('soldout')

    //바로 구매하기
    let purchaseBtn = document.getElementById("purchase")
    const purchaseURL = "{% url 'orders:payment_create' %}"

    // 무난이 작물, 일반 작물 전환
    let uglyTag = document.getElementById("ugly_tag")
    let normalTag = document.getElementById("normal_tag")

    // 품절 상품 여부
    let isSoldOut = "{{product.open}}";

    let title = document.getElementById("title")
    let subTitle = document.getElementById("subtitle")

    let costStr = document.getElementById("cost").innerHTML
    let cost = removeCommaInStringifiedNumber(costStr)
    let totalCost = document.getElementById("total_price")

    let quantityNumber = document.getElementById("quantity_number")

    let shippingFeeStr = document.getElementById("shipping-fee")
    let shippingFee = removeCommaInStringifiedNumber(shippingFeeStr)
    let shippingFeeDesc = document.getElementById("shipping-fee-desc")
    let weight = document.getElementById("product-weight")

    let mainImage = document.getElementById("main_image")

    let harvestDate = document.getElementById("harvest_date")
    let shelfLifeDate = document.getElementById("shelf_life_date")
    let law_genetic = document.getElementById("law_genetic")
    let law_disease = document.getElementById("law_disease")
    let law_record = document.getElementById("law_record")
    let law_location = document.getElementById("law_location")
    let law_livestock = document.getElementById("law_livestock")

    // uglyTag.addEventListener('click', function () {
    //     shootToastMessage("무난이 작물로 전환합니다", '2')

    //     title.innerHTML = '{{product.title}}'
    //     subTitle.innerHTML = '{{product.sub_title}}'
    //     cost.innerHTML = '{{product.sell_price}}원'
    //     weight.innerHTML = '{{product.weight}}{{product.weight_unit}}'
    //     totalCost.innerHTML = '{{product.sell_price}}'
    //     quantity_number.innerHTML = '1'
    //     if ('{{product.default_delivery_fee}}' == '0') {
    //         shippingFee.innerHTML = '무료'
    //         shippingFee.style.color = "#ff0000"
    //         shippingFeeDesc.innerHTML = '제주 외 도서지역 추가 배송비 추가'
    //     }
    //     else {
    //         shippingFee.innerHTML = '{{product.default_delivery_fee}}원'
    //         shippingFee.style.color = "#5c6854"
    //         shippingFeeDesc.innerHTML = '{{product.additional_delivery_fee_unit}}마다 추가 배송비 부과 / 제주 외 도서지역 추가 배송비 추가'
    //     }


    //     //메인 이미지 변경
    //     mainImage.setAttribute('sec', '{{product.main_image.url}}')

    //     //바로 구매하기 name pk 변경
    //     purchaseBtn.setAttribute('name', '{{product.pk}}')

    //     //버튼 색 변경
    //     this.style.color = "#fff"
    //     this.style.backgroundColor = "#5c6754"
    //     normalTag.style.color = "#5c6754"
    //     normalTag.style.backgroundColor = "#fff"

    //     //삼품 상세
    //     harvestDate.innerHTML = "{{product_harvest_start_date}} ~ {{product_harvest_end_date}}"
    //     shelfLifeDate.innerHTML = "{{product_shelf_life_date}}"
    // })

    // normalTag.addEventListener('click', function () {
    //     shootToastMessage("일반 작물로 전환합니다", '2')

    //     title.innerHTML = '{{related_product.title}}'
    //     subTitle.innerHTML = '{{related_product.sub_title}}'
    //     cost.innerHTML = '{{related_product.sell_price}}원'
    //     weight.innerHTML = '{{related_product.weight}}{{product.weight_unit}}'
    //     totalCost.innerHTML = '{{related_product.sell_price}}'
    //     quantity_number.innerHTML = '1'
    //     if ('{{related_product.default_delivery_fee}}' == '0') {
    //         shippingFee.innerHTML = "무료"
    //         shippingFee.style.color = "#ff0000"
    //         shippingFeeDesc.innerHTML = '제주 외 도서지역 추가 배송비 추가'
    //     }
    //     else {
    //         shippingFee.innerHTML = '{{related_product.default_delivery_fee}}원'
    //         shippingFee.style.color = "#5c6854"
    //         shippingFeeDesc.innerHTML = '{{related_product.additional_delivery_fee_unit}}마다 추가 배송비 부과 / 제주 외 도서지역 추가 배송비 추가'
    //     }


    //     //메인 이미지 변경
    //     mainImage.setAttribute('sec', '{{related_product.main_image.url}}')

    //     //바로 구매하기 name pk 변경
    //     purchaseBtn.setAttribute('name', '{{related_product.pk}}')

    //     //버튼 색 변경
    //     this.style.color = "#fff"
    //     this.style.backgroundColor = "#5c6754"
    //     uglyTag.style.color = "#5c6754"
    //     uglyTag.style.backgroundColor = "#fff"

    //     //상세 정보
    //     harvestDate.innerHTML = "{{rel_product_harvest_start_date}} ~ {{product_harvest_end_date}}"
    //     shelfLifeDate.innerHTML = "{{rel_product_shelf_life_date}}"

    // })

    // 농가 구독 플로팅 모달
    const floatingBtn = document.getElementById('farmer-sub-icon')
    const modalAjaxURL = "{% url 'farmers:farmer_subs_modal' %}"
    const farmerPK = "{{farmer.pk}}"
    const detailURL = "{% url 'farmers:farmer_detail' farmer.pk %}"
</script>
<script defer src="{% static 'js/event/siminwon_event_modal.js' %}"></script>
<script defer src="{% static 'js/products/product_detail.js' %}"></script>
{% endblock main_content %}